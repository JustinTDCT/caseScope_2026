{% extends "base.html" %}

{% block title %}Dashboard - CaseScope 2026{% endblock %}

{% block content %}
<div class="content-header">
    <div>
        <h1 class="content-title">System Dashboard</h1>
        <p class="text-secondary">Digital Forensics & Incident Response Platform</p>
    </div>
    <div class="content-actions">
        <a href="{{ url_for('create_case') }}" class="btn btn-primary">
            <span>+</span>
            <span>New Case</span>
        </a>
    </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üìÅ</div>
        <div class="stat-label">Total Cases</div>
        <div class="stat-value">{{ total_cases }}</div>
        <div class="stat-subtitle">Active investigations</div>
    </div>
    
    <div class="stat-card">
        <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üìÑ</div>
        <div class="stat-label">Files Indexed</div>
        <div class="stat-value">{{ total_files }}</div>
        <div class="stat-subtitle">EVTX & JSON files</div>
    </div>
    
    <div class="stat-card">
        <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">‚ö†Ô∏è</div>
        <div class="stat-label">SIGMA Violations</div>
        <div class="stat-value">{{ total_violations }}</div>
        <div class="stat-subtitle">Threat detections</div>
    </div>
    
    <div class="stat-card">
        <div style="font-size: 2rem; margin-bottom: var(--spacing-sm);">üéØ</div>
        <div class="stat-label">IOC Matches</div>
        <div class="stat-value">{{ total_ioc_matches }}</div>
        <div class="stat-subtitle">Indicator hits</div>
    </div>
</div>

<!-- Active Cases -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Active Cases</h2>
        <span class="text-secondary">{{ cases|length }} case(s)</span>
    </div>
    
    <div class="card-body">
        {% if cases %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Case Name</th>
                        <th>Company</th>
                        <th>Files</th>
                        <th>Events</th>
                        <th>SIGMA</th>
                        <th>IOCs</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for case in cases %}
                    <tr>
                        <td>
                            <strong>{{ case.name }}</strong>
                            {% if case.description %}
                            <br><span class="text-muted" style="font-size: 0.875rem;">{{ case.description[:50] }}...</span>
                            {% endif %}
                        </td>
                        <td>{{ case.company or 'N/A' }}</td>
                        <td>{{ case.files.filter_by(is_deleted=False, is_hidden=False).count() }}</td>
                        <td>
                            {% set total_events = case.files.filter_by(is_deleted=False, is_hidden=False).with_entities(db.func.sum(CaseFile.event_count)).scalar() or 0 %}
                            {{ '{:,}'.format(total_events) }}
                        </td>
                        <td>
                            {% set total_sigs = case.files.filter_by(is_deleted=False, is_hidden=False).with_entities(db.func.sum(CaseFile.violation_count)).scalar() or 0 %}
                            <span class="status-badge status-sigma">{{ total_sigs }}</span>
                        </td>
                        <td>
                            {% set total_iocs = case.files.filter_by(is_deleted=False, is_hidden=False).with_entities(db.func.sum(CaseFile.ioc_event_count)).scalar() or 0 %}
                            <span class="status-badge status-ioc">{{ total_iocs }}</span>
                        </td>
                        <td>{{ case.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <a href="{{ url_for('view_case', case_id=case.id) }}" class="btn btn-primary btn-sm">
                                View
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: var(--spacing-2xl); color: var(--color-text-muted);">
            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">üìÅ</div>
            <h3>No cases yet</h3>
            <p>Create your first case to get started with CaseScope 2026</p>
            <a href="{{ url_for('create_case') }}" class="btn btn-primary" style="margin-top: var(--spacing-lg);">
                Create First Case
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

